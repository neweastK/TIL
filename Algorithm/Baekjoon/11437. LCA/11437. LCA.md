## ğŸŒ ì•Œê³ ë¦¬ì¦˜ ë¬¸ì œ í’€ì´

### Baekjoon_11437. LCA

#### ğŸ“’ë¬¸ì œ

> N(2 â‰¤ N â‰¤ 50,000)ê°œì˜ ì •ì ìœ¼ë¡œ ì´ë£¨ì–´ì§„ íŠ¸ë¦¬ê°€ ì£¼ì–´ì§„ë‹¤. íŠ¸ë¦¬ì˜ ê° ì •ì ì€ 1ë²ˆë¶€í„° Në²ˆê¹Œì§€ ë²ˆí˜¸ê°€ ë§¤ê²¨ì ¸ ìˆìœ¼ë©°, ë£¨íŠ¸ëŠ” 1ë²ˆì´ë‹¤.
>
> ë‘ ë…¸ë“œì˜ ìŒ M(1 â‰¤ M â‰¤ 10,000)ê°œê°€ ì£¼ì–´ì¡Œì„ ë•Œ, ë‘ ë…¸ë“œì˜ ê°€ì¥ ê°€ê¹Œìš´ ê³µí†µ ì¡°ìƒì´ ëª‡ ë²ˆì¸ì§€ ì¶œë ¥í•œë‹¤.
>
> [<ë¬¸ì œ ì¶œì²˜>](https://www.acmicpc.net/problem/11437)



#### :pushpin: ì…ë ¥ ë° ì¶œë ¥

- ì²«ì§¸ ì¤„ì— ë…¸ë“œì˜ ê°œìˆ˜ Nì´ ì£¼ì–´ì§€ê³ , ë‹¤ìŒ N-1ê°œ ì¤„ì—ëŠ” íŠ¸ë¦¬ ìƒì—ì„œ ì—°ê²°ëœ ë‘ ì •ì ì´ ì£¼ì–´ì§„ë‹¤. ê·¸ ë‹¤ìŒ ì¤„ì—ëŠ” ê°€ì¥ ê°€ê¹Œìš´ ê³µí†µ ì¡°ìƒì„ ì•Œê³ ì‹¶ì€ ìŒì˜ ê°œìˆ˜ Mì´ ì£¼ì–´ì§€ê³ , ë‹¤ìŒ Mê°œ ì¤„ì—ëŠ” ì •ì  ìŒì´ ì£¼ì–´ì§„ë‹¤.

- Mê°œì˜ ì¤„ì— ì°¨ë¡€ëŒ€ë¡œ ì…ë ¥ë°›ì€ ë‘ ì •ì ì˜ ê°€ì¥ ê°€ê¹Œìš´ ê³µí†µ ì¡°ìƒì„ ì¶œë ¥í•œë‹¤.



---

> ì˜ˆì‹œ

```
input :
15
1 2
1 3
2 4
3 7
6 2
3 8
4 9
2 5
5 11
7 13
10 4
11 15
12 5
14 7
6
6 11
10 9
2 6
7 6
8 13
8 15

output :
2
4
2
1
3
1
```

----




#### ğŸš€point

1. LCA ì•Œê³ ë¦¬ì¦˜ì„ í™œìš©í•œ ë¬¸ì œ í’€ì´



#### ğŸ”í’€ì´

1.  ë°ì´í„° ê°’ì— ë”°ë¼ íƒìƒ‰í•  ì¸µì˜ ìµœê³ ì¹˜ë¥¼ êµ¬í•œë‹¤
    1.  ì´ ë•Œ, ìµœê³ ì¸µì„ kë¼ í•˜ë©´, kì¸µì´ ì•„ë‹Œ 2^kì¸µ ê¸°ì¤€ìœ¼ë¡œ êµ¬í•œë‹¤
    1.  ë°ì´í„° ìµœëŒ€ì¹˜ê°€ 50000ì´ë¯€ë¡œ ìµœê³ ì¹˜ëŠ” 16

1.  ì…ë ¥ê°’ì„ ë°›ê³  graph ë°°ì—´ì„ ìƒì„±í•œë‹¤
    1.  ì´ë•Œ, ì–´ë–¤ ë…¸ë“œê°€ ë¶€ëª¨ ë…¸ë“œì¸ì§€ ëª¨ë¥´ê¸° ë•Œë¬¸ì— ì–‘ìª½ ëª¨ë‘ì— ì¶”ê°€í•´ì¤€ë‹¤

1.  ë…¸ë“œë“¤ì˜ ë¶€ëª¨ ë…¸ë“œì™€ ê¹Šì´ë¥¼ êµ¬í•˜ê¸° ìœ„í•œ í•¨ìˆ˜ë¥¼ ì„ ì–¸í•œë‹¤
    1.  ë§¤ê°œë³€ìˆ˜ë¡œ ë…¸ë“œì™€ ê¹Šì´ë¥¼ ë°›ëŠ”ë‹¤
    1.  ë£¨íŠ¸ ë…¸ë“œëŠ” 1ë²ˆ ë…¸ë“œì´ë¯€ë¡œ ì²˜ìŒ ê°’ì„ 1ê³¼ ê¹Šì´ 0ì„ ë‚˜íƒ€ë‚´ê¸° ìœ„í•œ 0ìœ¼ë¡œ ë„£ì–´ì¤€ë‹¤
    1.  í•´ë‹¹ ë…¸ë“œì— ê¹Šì´ë¥¼ ê¸°ë¡í•˜ê³  ë°©ë¬¸ì²˜ë¦¬ë¥¼ í•´ì¤€ë‹¤
    1.  ì´ í›„, ì—°ê²°ëœ ë…¸ë“œë“¤ì€ ëª¨ë‘ ìì‹ë…¸ë“œì´ë¯€ë¡œ ë°˜ë³µë¬¸ì„ ëŒë©´ì„œ ìì‹ ë…¸ë“œì˜ ë¶€ëª¨ë…¸ë“œê°€ ë³¸ì¸ì„ì„ ë‚˜íƒ€ë‚¸ë‹¤
    1.  ì¬ê·€ë¡œ ë‹¤ì‹œ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œë‹¤

1.  dpë¥¼ í™œìš©í•˜ì—¬ ê° ë…¸ë“œì˜ ì¡°ìƒë…¸ë“œë“¤ì„ ê¸°ë¡í•œë‹¤
    1.  ì´ë•Œ, ëª¨ë“  ì¡°ìƒë…¸ë“œë¥¼ êµ¬í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ 2^kë²ˆì§¸ ì¡°ìƒë…¸ë“œë¥¼ êµ¬í•œë‹¤
        1.  íƒìƒ‰ì„ ë¹¨ë¦¬í•˜ê¸° ìœ„í•¨

    1.  ì í™”ì‹ì€ dp[n]\[k] = dp[dp[n]\[k-1]]\[k-1]ì´ë‹¤
    1.  ì´ë•Œ, ì—´ë¶€í„° ì±„ìš°ê³  ë‹¤ìŒ ì—´ë¡œ ì´ë™í•œë‹¤

1.  LCAë¥¼ êµ¬í•˜ëŠ” í•¨ìˆ˜ë¥¼ ì„ ì–¸í•œë‹¤
    1.  ìš°ì„  ë‘ ë…¸ë“œì˜ ê¹Šì´ë¥¼ ë§ì¶°ì¤€ë‹¤
        1.  ë” ê¹Šì€ ë…¸ë“œë¥¼ ì°¾ì•„ì£¼ê³  í•´ë‹¹ ë…¸ë“œë¥¼ ì˜®ê¸°ëŠ” ì‹ìœ¼ë¡œ ë…¸ë“œë¥¼ ë³€ê²½í•œë‹¤
        1.  ê¹Šì€ ë…¸ë“œì˜ ê¹Šì´ - ë‹¤ë¥¸ ë…¸ë“œì˜ ê¹Šì´ ë¥¼ êµ¬í•œë‹¤
        1.  í•´ë‹¹ ì°¨ë¥¼ 2ì§„ìˆ˜ë¡œ ë°”ê¿”ì¤€ í›„, ìµœëŒ€ë¡œ ì˜¬ë¦´ ìˆ˜ ìˆëŠ” ë†’ì´ì˜ ì¡°ìƒìœ¼ë¡œ ê°’ì„ ê°±ì‹ í•œë‹¤
        1.  ê¹Šì´ê°€ ê°™ì•„ì§ˆ ë•Œê¹Œì§€ ë°˜ë³µí•œë‹¤

    1.  ìµœì†Œ ê³µí†µ ì¡°ìƒì„ êµ¬í•œë‹¤
        1.  ê°€ì¥ ë†’ì€ ê³µí†µ ì¡°ìƒë¶€í„° ë‚´ë ¤ì˜¤ë©´ì„œ ê°’ì´ ë‹¤ë¥¼ ë•Œ ë©ˆì¶˜ë‹¤
        1.  ê°’ì´ ë‹¤ë¥´ë©´ ë‘ ë…¸ë“œì˜ ê°’ì„ ê°±ì‹ í•´ì£¼ê³  ë°˜ë³µì„ ì´ì–´ê°„ë‹¤
        1.  ìµœì¢…ì ìœ¼ë¡œ ê°±ì‹ ëœ ê°’ì€ ìµœì†Œê³µí†µì¡°ìƒì˜ ìì‹ ë…¸ë“œì´ë¯€ë¡œ, ê°±ì‹ ëœ ê°’ì˜ ë¶€ëª¨ ë…¸ë“œë¥¼ êµ¬í•œë‹¤

1.  ê¹Šì´ë¥¼ êµ¬í•˜ëŠ” í•¨ìˆ˜, dp ë°°ì—´ ìƒì„± í•¨ìˆ˜, lca í•¨ìˆ˜ ìˆœìœ¼ë¡œ ì‹¤í–‰ì‹œí‚¨ë‹¤.



#### ğŸ’»ì½”ë“œ

```python
import sys
input = sys.stdin.readline
sys.setrecursionlimit(10**9)

N = int(input())
graph = [[] for _ in range(N+1)]
node_depth = [0]*(N+1)
visited = [0]*(N+1)
MAX_HEIGHT = 16 # 2^16>50000>2^15
parent = [[0]*MAX_HEIGHT for _ in range(N+1)]

for _ in range(N-1):
    a,b = map(int,input().split())
    graph[a].append(b)
    graph[b].append(a)

# ë…¸ë“œë“¤ì˜ ë¶€ëª¨ ë…¸ë“œì™€ ê¹Šì´ êµ¬í•˜ê¸°
def dfs(x,depth):
    node_depth[x] = depth
    visited[x] = 1

    for i in graph[x]:
        if visited[i]:
            continue

        parent[i][0] = x
        dfs(i,depth+1)

# parent ë°°ì—´ì€ ì—´ë¶€í„° ì±„ì›Œë‚˜ê°€ì•¼í•¨í•¨
def set_parent():
    for j in range(1,MAX_HEIGHT):
        for i in range(1,N+1):
            parent[i][j] = parent[parent[i][j-1]][j-1]

# LCAë¥¼ êµ¬í•˜ëŠ” í•¨ìˆ˜
def lca(a,b):
    if node_depth[a]<node_depth[b]:
        a,b = b,a

    for i in range(MAX_HEIGHT-1,-1,-1):
        # ë…¸ë“œ ê°„ì˜ ê¹Šì´ ì°¨ì´ë¥¼ ì´ì§„ë²•ìœ¼ë¡œ ëª‡ë²ˆ ì´ë™ì‹œí‚¬ì§€ ê³„ì‚°
        if node_depth[a]-node_depth[b] >= (1<<i):
            a = parent[a][i]

    # ë§Œì•½ ì´ë¯¸ ì„œë¡œ ê°™ì€ ê°’ì´ë©´ ë°”ë¡œ ë°˜í™˜
    if a==b:
        return a
    # ë‹¤ë¥¸ ìƒíƒœë©´ ìœ„ì—ì„œë¶€í„° ê³µí†µ ì¡°ìƒ êµ¬í•˜ê¸°
    for j in range(MAX_HEIGHT-1,-1,-1):
        if parent[a][j] != parent[b][j]:
            a = parent[a][j]
            b = parent[b][j]

    return parent[a][0]

dfs(1,0)
set_parent()
M = int(input())
for _ in range(M):
    a,b = map(int,input().split())
    print(lca(a,b))
```



#### âŒ ë°œìƒ ì˜¤ë¥˜ ë° í•´ê²°

- 
