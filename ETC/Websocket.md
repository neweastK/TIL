# Websocket

> 서버와 클라이언트 간에 Socket Connection을 유지해서 언제든 양방향 통신 또는 데이터 전송이 가능하도록 하는 기술로 Real-time web application구현을 위해 널리 사용되어지고 있음

- 주식, 게임, 채팅 등 실시간으로 통신을 주고 받아야하는 서비스에서 주로 이용



### HTTP vs Websocket

#### HTTP

- 기존의 연결 방식
- 클라이언트가 Request를 보내야만 서버로부터 Response를 받을 수 있음
- 서버는 절대 Request 없이 어떠한 통신을 보내지 않음
- 서버쪽 데이터가 업데이트 되더라도 클라이언트 쪽에는 Refresh하지 않는한 변경된 데이터가 업데이트 되지 않는 문제가 발생
- Ajax 등으로 해결할 수는 있으나 자원의 비효율성, 많은 시간을 필요로 하는 문제점 등이 존재

#### Websocket

- 클라이언트와 서버가 서로에게 원할 때 데이터를 주고 받을 수 있음
- 데이터 송수신을 동시에 처리할 수 있는 통신 방법
- 웹페이지를 새로고침하거나 다른 주소로 이동할 때 덧붙인 부가 정보를 통해서만 새로운 데이터를 제공하는 웹서비스 환경의 문제를 해결해준 셈



### socket.io

> 양방향 통신을 하기 위해 웹소켓 기술을 활용하는 라이브러리
>
> node.js 기반으로 만들어진 기술로 거의 모든 웹 브라우저와 모바일 장치를 지원하는 실시간 웹 애플리케이션 지원 라이브러리
>
> WebSocket, FlashSocket, AJAX Long Polling, AJAX Multi part Streaming, IFrame, JSONP Polling 등 현존하는 대부분의 실시간 웹 기술들을 추상화. 즉, Socket.IO는 자바스크립트를 이용하여 브라우저 종류에 상관없이 실시간 웹을 구현할 수 있도록 한 기술

#### Websocket vs Socket.io

##### WebSocket

- HTML5 웹 표준 기술 : 양방향 소통을 위한 컴퓨터 간의 약속(==프로토콜)
- 매우 빠르게 작동하며 통신할 때 아주 적은 데이터를 이용함
- 이벤트를 단순히 듣고, 보내는 것만 가능함
- 가상화폐 거래소 같이 데이터 전송이 많은 경우에는 빠르고 비용이 적은 websocket을 이용하는게 용이

##### Socket.io

- 표준 기술이 아니며, 라이브러리임
- Websocket은 HTML5의 기술이기 때문에 오래된 버전의 웹 브라우저는 Websocket을 지원하지 않음. 이를 해결해줄 수 있는 기술 중 하나가 Socket.io
- 소켓 연결 실패 시 fallback을 통해 다른 방식으로 알아서 해당 클라이언트와 연결을 시도함
- 방 개념을 이용해 일부 클라이언트에게만 데이터를 전송하는 브로드캐스팅이 가능함
- 서버에서 연결된 사용자들을 세밀하게 관리해야하는 서비스인 경우에는 socket.io를 사용하는 것이 유리



### SockJS

> 애플리케이션이 우선적으로 WebSocket API를 사용하도록 하되, 사용할 수 없는 경우에는 런타임 시점에 코드 변경 없이 WebSocket 이외의 대안으로 대체 하도록 하는 것



### STOMP

> Simple Text oriented Messaging Protocol : WebSocket 위에서 동작하는 프로토콜로서, 클라이언트와 서버가 전송할 메시지 유형, 형식, 내용들을 정의하는 메커니즘

- TCP 또는 WebSocket 같은 양방향 네트워크 프로토콜 기반으로 동작
- frame을 사용하여 전송하는 프로토콜
- Publish-Subscribe 구조로 메시지를 전송하는 부분과 받아서 처리하는 부분이 확실하게 구조로 정해져있음
- STOMP를 사용하기 이전에는 WebSocketSession에 직접 메시지를 전달했어야하나, STOMP를 통해 특정 패턴을 구독함으로써 WebSocketSession을 직접 다루지 않아도 된다.

##### Broker

- 클라이언트가 서버에 메시지를 보내면 서버는 메시지에 특정 패턴을 심어 Broker에 전달
- Broker는 해당 패턴을 구독하고 있는 클라이언트들에게 메시지 전달
